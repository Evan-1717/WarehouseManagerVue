(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d207707"],{a112:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"100%"}},[t("div",{staticStyle:{"margin-bottom":"5px"}},[t("el-form",{ref:"form1",attrs:{model:e.form,"label-width":"75px"}},[t("el-col",{attrs:{span:5}},[t("el-form-item",{attrs:{label:"起止日期",prop:"creater"}},[t("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",placeholder:"起始时间","value-format":"yyyy-MM-dd"},model:{value:e.form1.date1,callback:function(t){e.$set(e.form1,"date1",t)},expression:"form1.date1"}}),e._v("- "),t("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",placeholder:"结束时间","value-format":"yyyy-MM-dd"},model:{value:e.form1.date2,callback:function(t){e.$set(e.form1,"date2",t)},expression:"form1.date2"}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{label:"短剧名称",prop:"creater"}},[t("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"短剧名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadPost.apply(null,arguments)}},model:{value:e.form1.playlet_name,callback:function(t){e.$set(e.form1,"playlet_name",t)},expression:"form1.playlet_name"}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{label:"短剧ID",prop:"creater"}},[t("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"短剧ID",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadPost.apply(null,arguments)}},model:{value:e.form1.playlet_id,callback:function(t){e.$set(e.form1,"playlet_id",t)},expression:"form1.playlet_id"}})],1)],1)],1),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:e.loadPost}},[e._v("查询")]),t("el-button",{attrs:{type:"success"},on:{click:e.resetParam}},[e._v("重置")]),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:e.add}},[e._v("新增")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2!=e.user.roleId,expression:"user.roleId!=2"}],staticStyle:{"margin-left":"5px"},attrs:{type:"primary"},on:{click:e.exportExcel}},[e._v("导出")])],1),t("el-table",{staticStyle:{overflow:"auto"},attrs:{data:e.tableData,border:"","max-height":"calc(100% - 200px)"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50",fixed:"left"}}),t("el-table-column",{attrs:{prop:"playlet_name",label:"短剧名称",width:"200",sortable:!0}}),t("el-table-column",{attrs:{prop:"playlet_id",label:"短剧ID",width:"170",sortable:!0}}),t("el-table-column",{attrs:{prop:"author",label:"作者",width:"100",sortable:!0}}),t("el-table-column",{attrs:{prop:"category",label:"主分类",width:"100",sortable:!0}}),t("el-table-column",{attrs:{prop:"abstract_info",label:"简介",sortable:!0}}),t("el-table-column",{attrs:{prop:"chapter_amount",label:"集数",width:"100",sortable:!0}}),t("el-table-column",{attrs:{prop:"free_chapter_count",label:"免费集数",width:"1 0",sortable:!0}}),t("el-table-column",{attrs:{prop:"price",label:"单章价格",width:"100",sortable:!0}}),t("el-table-column",{attrs:{prop:"release_time",label:"上线时间",width:"150",sortable:!0}}),t("el-table-column",{attrs:{prop:"promotion_times",label:"推广次数",width:"1 0",sortable:!0}}),t("el-table-column",{attrs:{prop:"operate",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.promotion(a.row)}}},[e._v("推广")]),t("el-popconfirm",{staticStyle:{"margin-left":"5px"},attrs:{title:"确定删除吗？"},on:{confirm:function(t){return e.del(a.row.id)}}},[t("el-button",{attrs:{slot:"reference",size:"small",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.pageNum,"page-sizes":[10,20,50,1e3],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:"提示",visible:e.centerDialogVisible,width:"500px",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[t("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"100px"}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短剧ID",prop:"playlet_id"}},[t("el-input",{model:{value:e.form.playlet_id,callback:function(t){e.$set(e.form,"playlet_id",t)},expression:"form.playlet_id"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"推广",visible:e.promotionDialogVisible,width:"500px",center:""},on:{"update:visible":function(t){e.promotionDialogVisible=t}}},[t("el-form",{ref:"form2",attrs:{model:e.form2,"label-width":"100px"}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短剧名称",prop:"playlet_name"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{disabled:!0},model:{value:e.form2.playlet_name,callback:function(t){e.$set(e.form2,"playlet_name",t)},expression:"form2.playlet_name"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短剧ID",prop:"playlet_id"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{disabled:!0},model:{value:e.form2.playlet_id,callback:function(t){e.$set(e.form2,"playlet_id",t)},expression:"form2.playlet_id"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"分销商",prop:"playlet_name"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择分销商!"},on:{change:e.distributorChange},model:{value:e.form2.distributor,callback:function(t){e.$set(e.form2,"distributor",t)},expression:"form2.distributor"}},e._l(e.distributors,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"分销商ID",prop:"playlet_name"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择分销商ID!"},on:{change:e.distributorIdChange},model:{value:e.form2.distributor_id,callback:function(t){e.$set(e.form2,"distributor_id",t)},expression:"form2.distributor_id"}},e._l(e.distributor_ids,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"充值模版",prop:"recharge_template_id"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择广告回传!"},model:{value:e.form2.adCallbackConfigId,callback:function(t){e.$set(e.form2,"adCallbackConfigId",t)},expression:"form2.adCallbackConfigId"}},e._l(e.adCallbackConfigList,(function(e){return t("el-option",{key:e.config_id,attrs:{label:e.config_name,value:e.config_id}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"充值模版",prop:"recharge_template_id"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择充值模版!"},model:{value:e.form2.recharge_template_id,callback:function(t){e.$set(e.form2,"recharge_template_id",t)},expression:"form2.recharge_template_id"}},e._l(e.recharge_templates,(function(e){return t("el-option",{key:e.recharge_template_id,attrs:{label:e.recharge_template_name,value:e.recharge_template_id}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"媒体类型",prop:"mini_program_name"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{disabled:!0},model:{value:e.form2.media_source,callback:function(t){e.$set(e.form2,"media_source",t)},expression:"form2.media_source"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"小程序",prop:"mini_program_name"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{disabled:!0},model:{value:e.form2.mini_program_name,callback:function(t){e.$set(e.form2,"mini_program_name",t)},expression:"form2.mini_program_name"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"标签",prop:"label"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择标签!"},model:{value:e.form2.label,callback:function(t){e.$set(e.form2,"label",t)},expression:"form2.label"}},e._l(e.labels,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"备注",prop:"mini_program_name"}},[t("el-input",{staticStyle:{width:"300px"},model:{value:e.form2.remark,callback:function(t){e.$set(e.form2,"remark",t)},expression:"form2.remark"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.doPromotion}},[e._v("确 定")])],1)],1)],1)},l=[],o={name:"PlayletManage",data(){return{user:JSON.parse(sessionStorage.getItem("CurUser")),tableData:[],pageSize:10,pageNum:1,total:0,name:"",centerDialogVisible:!1,promotionDialogVisible:!1,form:{playlet_id:""},form1:{date1:"",date2:"",playlet_name:"",playlet_id:""},form2:{playlet_name:"",playlet_id:"",distributor:"",distributor_id:"",mini_program_name:"",label:"",remark:"",recharge_template_id:"",adCallbackConfigId:""},distributors:[],distributor_ids:[],recharge_templates:[],adCallbackConfigList:[],labels:["大额","小额","不涉及"],rules:{playlet_id:[{required:!0,trigger:"blur"}]},modRow:{}}},methods:{distributorChange(e){this.$axios.post(this.$httpUrl+"/playlet/getdistributorIdBydistributor",{distributor:e}).then(e=>e.data).then(e=>{200==e.code?this.distributor_ids=e.data:this.$message({message:"操作失败！",type:"error"})})},distributorIdChange(e){this.$axios.post(this.$httpUrl+"/playlet/getdistributorIdInfo",{distributorId:e}).then(e=>e.data).then(e=>{200==e.code?(this.form2.media_source=e.data.media_source,this.form2.mini_program_name=e.data.mini_program_name,this.form2.secret_key=e.data.secret_key,this.recharge_templates=e.data.distributorIdInfo,this.adCallbackConfigList=e.data.adCallbackConfigInfo):this.$message({message:"操作失败！",type:"error"})})},fixed(e){return Number(e).toFixed(4)},fixed2(e){return Number(e).toFixed(2)},resetForm(){this.$refs.form.resetFields(),this.form.id=""},del(e){this.$axios.get(this.$httpUrl+"/playlet/del?id="+e).then(e=>e.data).then(e=>{200==e.code?(this.$message({message:"操作成功！",type:"success"}),this.loadPost()):this.$message({message:"操作失败！",type:"error"})})},promotion(e){this.promotionDialogVisible=!0,this.form2.playlet_name=e.playlet_name,this.form2.playlet_id=e.playlet_id,this.distributors=this.user.distributor},cancel(){this.$refs.form2.resetFields(),this.promotionDialogVisible=!1},doPromotion(){const e={playlet_id:this.form2.playlet_id,playlet_name:this.form2.playlet_name,distributor_id:this.form2.distributor_id,media_source:this.form2.media_source,secret_key:this.form2.secret_key,label:this.form2.label,creater:this.user.name,remark:this.form2.remark,recharge_template_id:this.form2.recharge_template_id,adCallbackConfigId:this.form2.adCallbackConfigId};this.$axios.post(this.$httpUrl+"/promotion/promotion",e).then(e=>e.data).then(e=>{200==e.code?(this.$message({message:"推广成功，推广链ID为："+e.data.promotion_id+"，推广链名称为："+ +e.data.promotion_name,type:"success"}),this.$refs.form2.resetFields(),this.promotionDialogVisible=!1):this.$message({message:"操作失败！",type:"error"})})},mod(e){this.centerDialogVisible=!0,this.$nextTick(()=>{this.form.id=e.id,this.form.playlet_name=e.playlet_name,this.form.playlet_id=e.playlet_id,this.form.release_time=e.release_time}),this.modRow=e},add(){this.centerDialogVisible=!0,this.$nextTick(()=>{this.resetForm()})},doSave(){this.$axios.post(this.$httpUrl+"/playlet/checkrecord",this.form).then(e=>e.data).then(e=>{0==e.data.length?(this.form.distributor_id="1809883619983433",this.$axios.post(this.$httpUrl+"/playlet/save",this.form).then(e=>e.data).then(e=>{200==e.code?(this.$message({message:"操作成功！",type:"success"}),this.centerDialogVisible=!1,this.loadPost(),this.resetForm()):this.$message({message:"操作失败！",type:"error"})})):this.$message({message:this.form.playlet_id+"已添加！",type:"error"})})},exportExcel(){this.form.time=this.currentDate(),this.form.creater=this.user.name,this.$confirm("确定导出？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$axios.request({url:this.$httpUrl+"/playlet/export",method:"post",data:{date1:this.form1.date1,date2:this.form1.date2,location:this.form1.location,content:this.form1.content,hiredate1:this.form1.hiredate1,hiredate2:this.form1.hiredate2,creater:this.form1.creater},responseType:"blob"}).then(e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download","投放记录"+(new Date).getTime()+".xlsx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(URL)}).catch(()=>{this.$message({message:"下载失败！",type:"error"})})})},currentDate(){var e=new Date,t=e.getFullYear(),a=e.getMonth();a=a+1>12?1:a+1,a=a>9?a:"0"+a.toString();var r=e.getDate(),l=e.getHours();l=l>9?l:"0"+l.toString();var o=e.getMinutes();o=o>9?o:"0"+o.toString();var i=e.getSeconds();return i=i>9?i:"0"+i.toString(),`${t}-${a}-${r} ${l}:${o}:${i}`},doMod(){this.form.time=this.currentDate(),this.form.creater=this.modRow.creater,this.$axios.post(this.$httpUrl+"/playlet/update",this.form).then(e=>e.data).then(e=>{200==e.code?(this.$message({message:"操作成功！",type:"success"}),this.centerDialogVisible=!1,this.loadPost(),this.resetForm()):this.$message({message:"操作失败！",type:"error"})})},save(){this.$refs.form.validate(e=>{if(!e)return!1;this.form.id?this.doMod():this.doSave()})},handleSizeChange(e){this.pageNum=1,this.pageSize=e,this.loadPost()},handleCurrentChange(e){this.pageNum=e,this.loadPost()},resetParam(){this.form1.date1="",this.form1.date2="",this.form1.location="",this.form1.content="",this.form1.hiredate1="",this.form1.hiredate2="",2!=this.user.roleId?this.form1.creater="":this.form1.creater=this.user.name},loadPost(){this.$axios.post(this.$httpUrl+"/playlet/listPage",{pageSize:this.pageSize,pageNum:this.pageNum,param:{date1:this.form1.date1,date2:this.form1.date2,location:this.form1.location,content:this.form1.content,hiredate1:this.form1.hiredate1,hiredate2:this.form1.hiredate2,creater:this.form1.creater}}).then(e=>e.data).then(e=>{200==e.code?(this.tableData=e.data,this.total=e.total):alert("获取数据失败")})}},beforeMount(){2!=this.user.roleId?this.form1.creater="":this.form1.creater=JSON.parse(sessionStorage.getItem("CurUser")).name,this.loadPost()}},i=o,s=a("2877"),n=Object(s["a"])(i,r,l,!1,null,"2d1342a1",null);t["default"]=n.exports}}]);
//# sourceMappingURL=chunk-2d207707.74d46f56.js.map